generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}
// Enums to standardize roles and produce statuses
enum Role {
  ADMIN
  FARMER
  WHOLESALER
  RETAILER
}

enum ProduceStatus {
  LISTED
  IN_ESCROW
  DELIVERED
}

// The User table (Linked via their Ethereum Wallet)
model User {
  id            String    @id @default(uuid())
  walletAddress String    @unique
  role          Role      @default(FARMER)
  name          String
  phone         String    @unique
  state         String
  city          String
  isVerified    Boolean   @default(false)
  createdAt     DateTime  @default(now())
  
  // ADD THIS LINE BELOW
  produce       Produce[] 
  ordersPlaced  Order[]
}

// Ensure your Produce model looks like this (which it likely already does)
model Produce {
  id          String   @id @default(uuid())
  name        String
  quantity    Float
  price       Float
  farmerId    String
  farmer      User     @relation(fields: [farmerId], references: [id])
  createdAt   DateTime @default(now())
  orders      Order[]
}

model Order {
  id          String   @id @default(uuid())
  produceId   String
  produce     Produce  @relation(fields: [produceId], references: [id])
  buyerId     String
  buyer       User     @relation(fields: [buyerId], references: [id])
  status      String   @default("PENDING") // Status can be PENDING, ACCEPTED, or COMPLETED
  createdAt   DateTime @default(now())
}

// Admin controlled Minimum Support Price table
model MinimumSupportPrice {
  id          String   @id @default(uuid())
  cropName    String
  state       String
  pricePerKg  Float
  lastUpdated DateTime @updatedAt
}